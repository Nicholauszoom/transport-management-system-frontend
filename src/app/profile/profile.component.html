<!-- Enhanced Profile Avatar with Status Indicator -->
<div class="profile-avatar-container">
  <p-avatar image="https://cdn-icons-png.flaticon.com/128/3177/3177440.png" shape="circle"
    class="cursor-pointer profile-avatar" (click)="toggleProfileCard($event)">
  </p-avatar>
  <div class="status-indicator" [ngClass]="getStatusClass()"></div>
</div>

<p-overlayPanel #op [dismissable]="true" [showCloseIcon]="false" [style]="{width: '350px', padding: '0'}"
  [appendTo]="'body'" styleClass="profile-overlay-panel">

  <ng-template pTemplate="content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading profile...</div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container">
      <div class="error-icon">
        <i class="pi pi-exclamation-triangle"></i>
      </div>
      <div class="error-message">{{ error }}</div>
      <p-button icon="pi pi-refresh" label="Retry" class="retry-btn" (click)="retryFetch()">
      </p-button>
    </div>

    <!-- Profile Content -->
    <div *ngIf="profile && !loading && !error" class="profile-content">
      <!-- Profile Header with Gradient Background -->
      <div class="profile-header">
        <div class="profile-image">
          <img [src]="getProfileImage()" [alt]="profile.username + ' profile'" />
        </div>
        <div class="username">{{ profile.username }}</div>
        <div class="role-badge">
          <i class="pi" [ngClass]="getRoleIcon()"></i>
          {{ profile.role || 'User' }}
        </div>
      </div>

      <!-- Profile Body -->
      <div class="profile-body">
        <div class="profile-info">
          <!-- Email Info -->
          <div class="info-item">
            <div class="info-icon email">
              <i class="pi pi-envelope"></i>
            </div>
            <div class="info-content">
              <div class="info-label">Email</div>
              <div class="info-value">{{ profile.email }}</div>
            </div>
          </div>

          <div class="info-item" >
            <div class="info-icon department">
              <i class="pi pi-building"></i>
            </div>
            <div class="info-content">
              <div class="info-label">Organization</div>
              <div class="info-value">BAYPORT FINANCE (TZ)</div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="profile-actions">
            <p-button icon="pi pi-user-edit" label="Edit Profile" class="edit-btn" (click)="editProfile()">
            </p-button>
            <p-button icon="pi pi-sign-out" label="Logout" class="logout-btn" (click)="logout()">
            </p-button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</p-overlayPanel>