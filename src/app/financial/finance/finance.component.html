<app-main-layout>
  <div class="flex justify-content-center flex-wrap w-full">
    <p-card [style]="{ width: '100%' }" styleClass="m-3">
      <ng-template pTemplate="header">
        <div class="p-card-header flex justify-content-between align-items-center">
          <h2 class="m-0" style="font-size: 1.5rem; color: #003366;">
            <i class="pi pi-tags text-primary" style="font-size: 1.5rem"></i> Bajaji Management
          </h2>


          <div class="button-group">
            <span class="p-input-icon-left">
              <i class="pi pi-search"></i>
              <input pInputText type="text" [(ngModel)]="term" placeholder="Search Bajaji" (input)="searchFinances()"
                style="width: 250px" />
            </span>
          </div>
        </div>
      </ng-template>

      <!-- Tab Menu -->
      <p-tabMenu [model]="tabItems" [activeItem]="activeTab" (activeItemChange)="onTabChange($event)"
        styleClass="mb-3"></p-tabMenu>

      <!-- Mandates Table with checkbox selection -->
     <p-table 
    [value]="finances" 
    [(selection)]="selectedFinances"
    dataKey="id"
    [paginator]="true"
    [rows]="pageSize"
    [totalRecords]="totalRecords"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
    [loading]="loading"
    styleClass="p-datatable-gridlines p-datatable-striped"
    [responsiveLayout]="'scroll'"
    [tableStyle]="{ width: '100%' }">

  <!-- Header -->
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 3rem">
        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
      </th>
      <th>#</th>
      <th>Plate Number</th>
      <th>Record Date</th>
      <th>Expense</th>
      <th>Profit</th>
      <th>Expense Notes</th>
      <th>Profit Notes</th>
      <th>Driver Submitted</th>
      <th>Driver Name</th>
      <th>Created At</th>
      <th>Actions</th>
    </tr>
  </ng-template>

  <!-- Body -->
  <ng-template pTemplate="body" let-finance let-rowIndex="rowIndex">
    <tr>
      <td>
        <p-tableCheckbox [value]="finance"></p-tableCheckbox>
      </td>

      <!-- Row number -->
      <td>{{ (currentPage - 1) * pageSize + rowIndex + 1 }}</td>

      <td>{{ finance.plateNumber }}</td>
      <td>{{ finance.recordDate | date: 'yyyy-MM-dd' }}</td>
      <td>{{ finance.expense | number:'1.2-2' }}</td>
      <td>{{ finance.profit | number:'1.2-2' }}</td>
      <td>{{ finance.expenseNotes }}</td>
      <td>{{ finance.profitNotes }}</td>
      <td>
        <p-tag 
          [severity]="finance.driverSubmitted ? 'success' : 'danger'" 
          [value]="finance.driverSubmitted ? 'YES' : 'NO'">
        </p-tag>
      </td>
      <td>{{ finance.driverName }}</td>
      <td>{{ finance.createdAt | date: 'yyyy-MM-dd HH:mm' }}</td>

      <td>
        <p-menu 
          #menu 
          [popup]="true" 
          [model]="getMenuItems(finance)" 
          appendTo="body">
        </p-menu>

        <p-button 
          icon="pi pi-ellipsis-v"
          styleClass="p-button-text"
          (click)="menu.toggle($event)">
        </p-button>
      </td>
    </tr>
  </ng-template>

  <!-- Empty Message -->
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="12" class="text-center">No financial records found.</td>
    </tr>
  </ng-template>
</p-table>

    </p-card>
  </div>
</app-main-layout>